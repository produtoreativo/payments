name: Deployment

on:
  push:
    branches:
      - "**"

jobs:
  deployment:
    runs-on: ubuntu-latest
    environment: staging
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Login to Heroku Container registry
        env: 
          HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
        run: heroku git:remote -a payments-prodoops 

      - name: Build and push
        env:
          HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
        run: git push heroku master
        # run: heroku deploy:master -a payments-prodoops 
      # - name: Release
      #   env:
      #     HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
      #   run: heroku container:release -a ${{ secrets.HEROKU_APP_NAME }} web 

      # - name: Deploy
      #   uses: akhileshns/heroku-deploy@v3.12.12
      #   with:
      #     heroku_api_key: ${{secrets.HEROKU_API_KEY}}
      #     heroku_app_name: "payments-prodoops"
      #     heroku_email: "cmilfont@gmail.com"
      #     branch: "master"
      #     remote_branch: "master"
      #     healthcheck: "https://payments-prodoops.herokuapp.com/s"
      #     checkstring: "Hello World!"
      #     delay: 5
      #     rollbackonhealthcheckfailed: true
